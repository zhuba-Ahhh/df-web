import{j as e,d as t}from"./.pnpm-BsixHraz.js";import{h as a,c as s,u as l,a as r,I as c,w as n,g as i,f as d}from"./index-B1HgvZ_M.js";const m=(e,t)=>{if(!e||!t)return[];const a=[],s=(e=>{if("string"!=typeof e)return null;const t=e.split("#"),a=/[\u4e00-\u9fa5]+/g;return t.map((e=>{const t=e.replace(a,(e=>`"${e}"`));try{return t?JSON.parse(t.replace(/'/g,'"')):null}catch(s){return null}})).filter(Boolean)})(e)||[];for(const r of s)if(r)try{if("收集品"===r.auctontype){const e=t[r.itemid.toString()];if(e&&e.name){const t=r.inum>1?r.iPrice/r.inum:r.iPrice;a.push({itemid:r.itemid,name:e.name,singlePrice:t,img:e.img||`${r.itemid}.png`,grade:e.grade})}}}catch(l){}return a.sort(((e,t)=>t.singlePrice-e.singlePrice)).slice(0,10)},o=({carryOutListStr:t,collectionData:a})=>{const l=m(t,a);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"本周带出最有价值藏品"}),l.length>0?e.jsx("div",{className:"flex mt-1 space-x-2 items-start overflow-x-auto pr-1 hide-scrollbar",children:l.map((t=>e.jsxs("div",{className:"flex flex-col items-center p-1.5 rounded bg-gray-700/50 border border-gray-600/50 w-24 text-center earnings-item2",style:{backgroundColor:s[Number(t.grade||0)-1]},children:[e.jsx("img",{src:`//game.gtimg.cn/images/dfm/cp/weekly20241129/collection/${t.img}`,alt:t.name,className:"w-12 h-12 object-contain mb-0.5",onError:e=>{e.currentTarget.src="//via.placeholder.com/48?text=Error"}}),e.jsx("span",{className:"text-xs text-gray-200 leading-tight block truncate w-full earnings-name",children:e.jsx("em",{children:t.name})}),e.jsx("span",{className:"text-xs text-yellow-400 font-semibold",children:t.singlePrice.toLocaleString()})]},t.itemid)))}):e.jsx("div",{className:"text-base font-medium text-gray-500 mt-1",children:"无"})]})},x=(e,t)=>{const a=parseFloat(e||"");return isNaN(a)?"N/A":void 0!==t?a.toFixed(t):a.toLocaleString()},g=()=>{const e=[];let a=t();for(;e.length<5;)0===a.day()&&e.push(a.format("YYYYMMDD")),a=a.subtract(1,"day");return e},u=({consumePrice:t,gainedPrice:a,netIncome:s,maxItem:l})=>e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-2",children:[e.jsxs("div",{className:"flex flex-col p-3 bg-gray-700 rounded-md",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"本周总带入"}),e.jsx("span",{className:"text-lg font-medium text-green-400",children:t.toLocaleString()})]}),e.jsxs("div",{className:"flex flex-col p-3 bg-gray-700 rounded-md",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"本周总带出"}),e.jsx("span",{className:"text-lg font-medium text-red-400",children:a.toLocaleString()})]}),e.jsxs("div",{className:"flex flex-col p-3 bg-gray-700 rounded-md",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"本周净收益"}),e.jsx("span",{className:"text-lg font-medium "+(s>=0?"text-green-400":"text-red-400"),children:s.toLocaleString()})]}),e.jsxs("div",{className:"flex flex-col p-3 bg-gray-700 rounded-md",children:[e.jsx("span",{className:"text-sm text-gray-400",children:l?`${l.weekdayEn}价值最高`:"本周价值最高"}),e.jsx("span",{className:"text-lg font-medium text-yellow-400",children:l?l.totalPriceFormatted:"N/A"})]})]}),h=(t,a)=>e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 p-3 bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"排名分数"}),e.jsxs("span",{className:"text-lg font-medium",children:[i(t.Rank_Score,a.rank||{})," (",t.Rank_Score,")"]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"百万撤离（次）"}),e.jsx("span",{className:"text-lg font-medium",children:t.GainedPrice_overmillion_num})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Boss击杀"}),e.jsx("span",{className:"text-lg font-medium",children:x(t.total_Kill_Boss)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"玩家击杀"}),e.jsx("span",{className:"text-lg font-medium",children:x(t.total_Kill_Player)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"总游戏时长（小时）"}),e.jsx("span",{className:"text-lg font-medium",children:d(t.total_Online_Time)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"总场数（场）"}),e.jsx("span",{className:"text-lg font-medium",children:t.total_sol_num})]})]}),p=()=>{const[s]=React.useState(g()[0]||""),[i,d]=React.useState(null),[m,x]=React.useState(!1),{ck:p,changeCk:f}=l(),N=r(),j=React.useCallback((async()=>{if(p){x(!0);try{const e=await(async(e,t)=>{try{return await a.get("/week/getWeek",{params:{ck:e,statDate:t}})}catch(s){return null}})(p,s);d(e)}finally{x(!1)}}}),[p,s]);return React.useEffect((()=>{j()}),[s,j]),e.jsxs("div",{className:"p-3 md:p-6 bg-gray-900 text-white min-h-screen",children:[e.jsx(c,{ck:p,changeCk:f,dateOptions:g()}),m?e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-4 text-gray-400",children:"加载中..."})]}):i?(()=>{const a=parseFloat(i.Gained_Price)||0,s=parseFloat(i.consume_Price)||0,l=i.Total_Price?i.Total_Price.split(","):[],r=!(c=l)||0===c.length||1===c.length&&""===c[0]?[]:null==c?void 0:c.map((e=>{var t;const a=e.split("-");if(a.length<3)return{date:"无效数据",weekday:"",weekdayEn:"",totalPriceFormatted:"N/A",totalPriceRaw:0};const[s,l,r]=a,c=Number(r);if(isNaN(c))return{date:"无效数据",weekday:"",weekdayEn:"",totalPriceFormatted:"N/A",totalPriceRaw:0};const i=(null==(t=n.find((e=>e.value===s)))?void 0:t.key)||s;return{date:l&&8===l.length?`${l.slice(0,4)}-${l.slice(4,6)}-${l.slice(6,8)}`:l||"未知日期",weekday:s||"未知",weekdayEn:i,totalPriceFormatted:c.toLocaleString(),totalPriceRaw:c}}));var c;const{netIncome:d,maxItem:m}=(e=>{if(0===e.length)return{netIncome:0,maxItem:null};const a=e.reduce(((e,t)=>t.totalPriceRaw>e.totalPriceRaw?t:e),e[0]),s=e.reduce(((e,t)=>t.totalPriceRaw<e.totalPriceRaw?t:e),e[0]),l=t(a.date);return{netIncome:t(s.date).isAfter(l)?-(a.totalPriceRaw-s.totalPriceRaw):a.totalPriceRaw-s.totalPriceRaw,maxItem:a}})(r);return e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-100",children:"行动数据"}),u({consumePrice:s,gainedPrice:a,netIncome:d,maxItem:m})]}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-3",children:e.jsx(o,{carryOutListStr:i.CarryOut_highprice_list,collectionData:null==N?void 0:N.allCollectsMap})}),h(i,N),r.length>0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3",children:[e.jsx("h3",{className:"text-lg font-medium mb-4 text-gray-100",children:"本周每日仓库价值"}),e.jsx("div",{className:"space-y-2",children:r.map(((t,a,s)=>{const l=a>0?s[a-1].totalPriceRaw:0,r=t.totalPriceRaw-l;return e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-base text-gray-300",children:t.date.slice(5)}),e.jsxs("span",{className:"ml-2 text-base text-gray-400",children:["(",t.weekdayEn,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[a>0&&e.jsxs("span",{className:"text-sm font-medium "+(r>=0?"text-green-400":"text-red-400"),children:[r>=0?"+":"",r.toLocaleString()]}),e.jsx("span",{className:"text-base font-medium text-gray-100",children:t.totalPriceFormatted})]})]},a)}))})]})]})})():e.jsx("div",{className:"mt-4 text-center text-gray-400",children:"无本周数据记录"})]})};export{p as default};
